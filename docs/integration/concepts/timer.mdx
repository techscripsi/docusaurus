---
---

import Timer from './img/timer.svg';
import TimerFlowchart from './img/timer_flowchart.svg';

# Item Timers

## Description

Грубо говоря, пока таймер включён, пользователь не может снова приобрести эту товарную позицию. Вы можете использовать его, например, для предоставления временного доступа к продаваемому ресурсу. Фактически, это подписка.

Пример использования:

* временный бафф в игре
* отключение, подключение услуги (например, одноразовый платёж для отключения рекламы).

Для запуска таймера на товарную позицию в корзине нужно передать `customerId`. Тогда OmniCart запоминает связку клиента и товрной позиции.

Таймер может быть включён по условию или вручную - с помощью запроса modify.

* условием включения таймера является статус товарной позиции. Например, у вас двухстадийный платежи и вы настроили условие запуска таймера - переход в состояние captured. Это значит, что займер запускается, когда пользователь подтвердил оплату со своей стороны, а вы подтвердили её со своей. Когда товарная позиция переходит в состояние captured, начинается обратный отсчёт таймера.

Обратный отсчёт таймера указывается в секундах. То есть, если вы, например, предоставляете временный доступ на два часа, то значение таймера будет `7200` секунд.

Значение таймера 0 означает, что таймер бессрочный. Это можно использовать для одноразовых покупок (например для подключения одноразовой услуги). Если выставлено это значение, пока таймер активен (то есть, не остановлен вручную), пользователь не сможет купить эту товарную позицию. 


:::warning
Чтобы отменить бессрочное действие таймера, нужно изменить его настройки с помощью запроса modify.
:::

:::note
Можно установить любой статус платежа как условие запуска таймера, даже текущий статус или статус в прошлом. Например, вы регистрируете корзину и ставите условие запуска таймера статус initiated. Это значит что таймер запускается сразу в момент создания корзины, т. к. initiated - это исходный статус корзины и всех позиций в ней.

Также, если таймер не был включён, и сейчас статус `itemId` captured, и вы ставите условие запуска таймера initiated, то таймер запускается, так как статус initiated предшествует captured

Уточните дозволенные действия в личном кабинете.
:::

Завершением жизненного цикла таймера является его статус stopped (остановлен вручную) или expired (обратный отсчёт закончен). В любых предшествующих состояниях таймер считается активным, что будет препятствовать дальнейшей покупке товарной позиции пользователем.

## Flowchart Mermaid II

<Mermaid
  value={`
    flowchart TB
      a[Not set] --> Pending
      a[Not set] -- Set with<br />past or current<br />trigger event --> Started
      Pending -- Trigger event<br /> or manual start--> Started
      Paused -- Manual start --> Started
      Started -- Manual pause--> Paused
      Started -- Time elapses --> Expired
      Paused -- Manual stop --> Stopped
      Started -- Manual stop --> Stopped
  `}

/>